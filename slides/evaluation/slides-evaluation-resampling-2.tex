\input{../../style/preamble}
\input{../../latex-math/basic-math.tex}
\input{../../latex-math/basic-ml.tex}
\input{../../latex-math/ml-eval.tex}
\input{../../latex-math/ml-hpo.tex}

\newcommand{\titlefigure}{figure_man/crossvalidation}
\newcommand{\learninggoals}{
\item Understand advantages of subsampling over single hold-out split
\item Understand challenges when comparing learners based on CV results
\item Understand what pessimistic bias means
\item Be able to compare different resampling strategies}


\title{Introduction to Machine Learning}
% \author{Bernd Bischl, Christoph Molnar, Daniel Schalk, Fabian Scheipl}
\institute{\href{https://compstat-lmu.github.io/lecture_i2ml/}{compstat-lmu.github.io/lecture\_i2ml}}
\date{}

\begin{document}

\lecturechapter{Evaluation: Resampling 2}
\lecture{Introduction to Machine Learning}
\sloppy


% ------------------------------------------------------------------------------
GE(I, n, L) ::: GE_hat(I, ntrain, L)


GE_hat = 1/m sum_{i=1 bis m} L(y_test_i, I(Dtrain)(x_test_i))

E[ GE_hat] = 1/m sum_{i=1 bis m} E [L(y_test_i, I(Dtrain)(x_test_i)) ] = GE(I, ntrain, L)

Bias: - GE(I, ntrain, L)


\begin{vbframe}{Bias-Variance Analysis for Subsampling}

  \begin{itemize}
    \item Reconsider our hold-out experiment on the \texttt{spirals} data from 
    the train-test unit (maybe re-read it again)
    \item Again, we use split rates $s \in \{0.05, 0.1, ..., 0.95\}$ for 
    training with $|\Dtrain| = s \cdot 500$.
    \item But: now we compare 50 subsampling experiments with $50 \cdot 50$ 
    hold-out experiments per split.
    \item Every subsampling experiment is the result of averaging 50 hold-out 
    experiments, so each performance estimate is much more reliable (but also 
    more expensive) than one computed by a single hold-out experiment.
  \end{itemize}

\framebreak

\begin{center}
% FIGURE SOURCE: eval-resampling-example
\includegraphics[width=0.9\textwidth]{figure/eval-resampling-example-1}
\end{center}



\begin{itemize}
  \item Both experiments are compared to the "real" MCE (black line).
  \item Subsampling has the same pessimistic bias for small split rates but 
  much less variance overall.
  \item This allows to use much smaller test sets with good results.
\end{itemize}

\framebreak

\begin{center}
% FIGURE SOURCE: eval-resampling-example
\includegraphics[width=0.7\textwidth]{figure/eval-resampling-example-2}
\end{center}

\begin{itemize}
  \item The MSE is strictly better for subsampling compared to hold-out.
  \item The optimal split rate now is a higher $s \approx 0.8$.
  \item We see the variance picking up at the end because training sets 
  increasingly overlap.
\end{itemize}

\end{vbframe}

% ------------------------------------------------------------------------------

\begin{vbframe}{Comparing learners based on CV results}
\begin{footnotesize}
\begin{itemize}
\item Since the $k$ training sets and their respective independent test sets stem
from the same distribution we get $k$ unbiased estimators of $\GEfull$.
\item However, in order to compare two different learners we also need to assess the 
uncertainty of our overall  estimator.
\item This becomes challenging since the $k$ splits are not independent of each other: 
\item $\mathbb{V}[\GEh]$ of CV is a linear combination of 
\begin{itemize}
\begin{footnotesize}
\item the average variance we get from estimating from finite training sets,
\item the covariance arising from the dependence of test errors the learners made
since they were trained on overlapping training sets,
\item the covariance due to the dependence of training sets and that test sets appear
also in training sets. [Bengio, 2004]
\end{footnotesize}
\end{itemize}
\item[$\Rightarrow$] Taking the empirical variance of the $k$ $\GEh$s yields a biased 
estimator of $\mathbb{V}[\GEh]$.
\item[$\Rightarrow$] These dependences should be taken into account 
when testing if a learner is significantly better than another. 

\end{itemize}
\end{footnotesize}
\end{vbframe}

% ------------------------------------------------------------------------------

\begin{vbframe}{Resampling discussion}

\begin{itemize}

  \item In ML we fit, at the end, a model on all our given data.\\

  \item \textbf{Problem:} We need to know how well this model will perform in 
  the future, but no data is left to reliably quantify this.\\
  $\Rightarrow$ Approximate using hold-out / CV / bootstrap / subsampling \\
  estimate\\ 

  \item \textbf{But:} pessimistic bias because we don't use all data points.\\

  \item The final model is (usually) computed on all data points.

  \item Strictly speaking, resampling only produces one number, the performance 
  estimator.
  It does NOT produce models, parameters, etc. These are intermediate results 
  and discarded.
  
  \item The model and parameters are only obtained when we finally fit the 
  learner on the complete data.

\end{itemize}

\framebreak

% \begin{itemize}
%   \item 5-CV or 10-CV have become standard.
%   \item Do not use hold-out, CV with few iterations, or subsampling with a low 
%   subsampling rate for small samples, since this can cause the estimator to be 
%   extremely biased, with large variance.
%   \item For small-data situations with less than 500 or 200 observations, use 
%   LOO or, probably better, repeated CV.
%   \item For some models, computationally fast calculations or approximations 
%   for LOO exist.
%   \item A data set $\D$ with $|\D| = 100.000$ can have small-sample properties 
%   if one class has few observations 
%   \item Research indicates that subsampling has better properties than
%     bootstrapping. The repeated observations can cause problems in training,
%     especially in nested setups where the \enquote{training} set is split up again.
% \end{itemize}
% 
% \framebreak

\fboxsep=0pt
\noindent%
\begin{minipage}[t]{0.42\linewidth}
\vspace{0pt}
\includegraphics{figure_man/resampling_dec_tree}
\end{minipage}%
\hfill%
%
\begin{minipage}[t]{0.58\linewidth}
\vspace{0pt}
\scriptsize
\begin{itemize}
  \item 5-CV or 10-CV have become standard.
  \item Do not use hold-out, CV with few iterations, or subsampling with a low 
  subsampling rate for small samples, since this can cause the estimator to be 
  extremely biased, with large variance.
  \item For small-data situations with less than 500 or 200 observations, use 
  LOO or, probably better, repeated CV.
  \item For some models, computationally fast calculations or approximations 
  for LOO exist.
  \item A data set $\D$ with $|\D| = 100.000$ can have small-sample properties 
  if one class has few observations 
  \item Research indicates that subsampling has better properties than
    bootstrapping. The repeated observations can cause problems in training,
    especially in nested setups where the \enquote{training} set is split up again.
\end{itemize}
\end{minipage}



\end{vbframe}

\endlecture
\end{document}
