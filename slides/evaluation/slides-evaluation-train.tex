\input{../../style/preamble}
\input{../../latex-math/basic-math.tex}
\input{../../latex-math/basic-ml.tex}
\input{../../latex-math/ml-eval.tex}

\newcommand{\titlefigure}{figure/eval_train_2}
\newcommand{\learninggoals}{
\item Understand the definition of training error
\item Understand why training error is no reliable estimator of future performance}


\title{Introduction to Machine Learning}
% \author{Bernd Bischl, Christoph Molnar, Daniel Schalk, Fabian Scheipl}
\institute{\href{https://compstat-lmu.github.io/lecture_i2ml/}{compstat-lmu.github.io/lecture\_i2ml}}
\date{}

\begin{document}

\lecturechapter{Evaluation: Train Error}
\lecture{Introduction to Machine Learning}
\sloppy

% ------------------------------------------------------------------------------

\begin{vbframe}{Training Error}

The \textbf{training error} (also called apparent error or resubstitution error)
is estimated by averaging the errors over the training observations that have 
been used to fit the model:
\small
$$\rho(\yv_{\mathrm{train}}, F_{\textrm{train}})\;\text{where}\; F_{\textrm{train}} = 
\begin{bmatrix} \fhDtrain(\xi[1]_{\textrm{train}})^\top & \dots & \fhDtrain(\xi[m]_{\textrm{train}})^\top \end{bmatrix}^\top$$ 

\begin{center}
% FIGURE SOURCE: https://docs.google.com/drawings/d/1m0Uwf5bvWuP1agyZ0TOd0qaBakJVtfe_PspxqPL3mxU/edit?usp=sharing
\includegraphics[width=.45\textwidth]{figure_man/train_error.pdf}
\end{center}

\end{vbframe}

% ------------------------------------------------------------------------------

\begin{vbframe}{Example: Polynomial Regression}

Sample data from sinusoidal function
$0.5 + 0.4 \cdot \sin (2 \pi x) + \epsilon$\\
with measurement error $\epsilon$:

\vfill

\begin{center}
  \includegraphics[width=0.85\textwidth]{figure/eval_train_1}
\end{center}

Now assume the data-generating process to be unknown as usual.\\
Try to approximate the data with a $d^{th}$-degree polynomial:
\[ \fxt = \theta_0 + \theta_1 \xv + \cdots + \theta_d \xv^d = \sum_{j = 0}^{d}
\theta_j \xv^j\text. \]

\framebreak

Different polynomial orders give rise to models of varying \textbf{complexity}.
$\rightarrow$ How to choose $d$?

\vfill

\begin{minipage}[c]{0.6\textwidth}
  % \centering
  \includegraphics[width=\textwidth]{figure/eval_train_2} 
\end{minipage}%
\begin{minipage}[c]{0.4\textwidth}
  \begin{itemize}
    \footnotesize
    \item $d = 1$: MSE = 0.036: \\clearly underfitting
    \item $d = 3$: MSE = 0.003: \\pretty OK
    \item $d = 9$: MSE = 0.001: \\clearly overfitting
  \end{itemize}
\end{minipage}

\vfill

$\rightarrow$ Choosing $d$ based on minimal training error seems to be a bad 
idea.

\end{vbframe}

% ------------------------------------------------------------------------------

\begin{vbframe}{Training Error Problems}

\begin{itemize}
  \item The training error is an unreliable and \textbf{optimistically biased} 
  estimator of future performance. \\
  $\rightarrow$ Extreme example: training error of 1-NN is always 0 as each 
  observation is its own NN at test time.
  \item We are interested in modeling the inherent data structure, not in 
  fitting every peculiarity or noise in the training data.
  \item \textbf{Goodness-of-fit} measures like (classic) $R^2$, likelihood, AIC, 
  BIC, deviance are all based on the training error.
  \item For models of restricted capacity, and given enough data, the training 
  error may provide reliable information.
  \begin{itemize}
    \item E.g., for a linear model with 5 features and $10^6$ training points.
    \item \textbf{But:} it is impossible to know when the training error starts 
    to become unreliable.
  \end{itemize}
  % \item \textcolor{blue}{Extend any ML training in the following way:
  %   After normal fitting, we also store the training data.
  %   During prediction, we first check whether $x$ is already stored in this set. 
  %   If so, we replicate its label.
  %   The train error of such an (unreasonable) procedure will be 0.}
  % \item \textcolor{blue}{There are so called interpolators - interpolating 
  % splines, interpolating Gaussian processes - whose predictions can always 
  % perfectly match the regression targets, they are not necessarily good as they 
  % will interpolate the noise too.}
\end{itemize}
\end{vbframe}

% ------------------------------------------------------------------------------

\begin{vbframe}{training error and generalization}

\begin{minipage}[c]{0.6\textwidth}
  \small
  We simulate 100,000 points from the \texttt{spirals} data with $sd = 0.1$ and 
  train a $k$-NN classifier with $k$ set to 15.
\end{minipage}%
\begin{minipage}[c]{0.05\textwidth}
  \phantom{foo}
\end{minipage}%
\begin{minipage}[c]{0.35\textwidth}
  \includegraphics[width = 0.9\textwidth]{figure/eval_delta_train_test_err_data}
\end{minipage}%

\vfill

\small

For a sufficient amount of training data the training error should yield a 
fairly good indication of the true generalization ability.

\vfill

We set aside a very large test set of 70,000 observations to gauge the true 
generalization error as well as possible.
Steadily increasing the training set size from 16 to 30,000 data points, we 
observe how the gap between training and test error narrows and bottoms 
out close to 0:

\vfill

\includegraphics[width = \textwidth]{figure/eval_delta_train_test_err}

\framebreak

% ------------------------------------------------------------------------------

\small

The example suggests that, for a large amount of training data and a rather
simple learner, the training error can hold quite reliable information about 
the learner's ability to generalize.

\vfill

\textbf{But:} assuming a more realistic scenario with a total of 500 training
observations (while the test set remains the same) and allowing for more 
complexity, the picture changes:

\vfill

\begin{center}
\includegraphics[width = 0.7\textwidth]{figure/eval_delta_train_test_overfit}
\end{center}

\vfill

The low training error for small $k$ is deceptive -- as the model becomes more 
and more local, test error starts creeping up as the learner fits the 
training data very closely at the expense of generalization.

\end{vbframe}

% ------------------------------------------------------------------------------

\endlecture
\end{document}
